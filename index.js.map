{"version":3,"file":"index.js","sources":["../src/search.js"],"sourcesContent":["import axios from 'axios';\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\n\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nconst form = document.getElementById('search-form');\nconst gallery = document.querySelector('.gallery');\nconst loadMoreBtn = document.getElementById('load-more');\nconst loader = document.querySelector('.loader');\nconst loadingText = document.querySelector('.loading-text');\nconst endMessage = document.querySelector('.end-message');\n\nconst BASE_URL = 'https://pixabay.com/api/';\nconst API_KEY = '51560990-264b69e56c9798190df8f6558';\n\nconst lightbox = new SimpleLightbox('.gallery a');\n\nlet currentPage = 1;\nlet currentQuery = '';\nlet totalHits = 0;\n\nwindow.addEventListener('DOMContentLoaded', () => {\n       hideLoadMoreBtn();\n    \n  const params = new URLSearchParams(window.location.search);\n  const query = params.get('query');\n  if (query) {\n    form.searchQuery.value = query;\n    startNewSearch(query);\n  }\n});\n\nform.addEventListener('submit', event => {\n  event.preventDefault();\n  const query = form.searchQuery.value.trim();\n  if (!query) return;\n  updateQueryParam(query);\n  startNewSearch(query);\n});\n\nloadMoreBtn.addEventListener('click', () => {\n  currentPage += 1;\n  performSearch(currentQuery, currentPage);\n});\n\nfunction updateQueryParam(query) {\n  const newUrl = `${window.location.pathname}?query=${encodeURIComponent(query)}`;\n  window.history.pushState({ path: newUrl }, '', newUrl);\n}\n\nfunction startNewSearch(query) {\n  currentQuery = query;\n  currentPage = 1;\n  totalHits = 0;\n  gallery.innerHTML = '';\n  hideEndMessage();\n  hideLoadMoreBtn();\n  performSearch(query, currentPage);\n}\n\nasync function performSearch(query, page = 1) {\n  showLoading();\n  hideLoadMoreBtn();\n  try {\n    const data = await fetchImages(query, page);\n    totalHits = data.totalHits;\n\n    if (data.hits.length === 0 && page === 1) {\n      iziToast.warning({\n        class: 'my-warning-toast',\n        message: 'Sorry, no images match your search. Please try again!',\n        position: 'topRight',\n      });\n      hideLoading();\n      return;\n    }\n\n    renderGallery(data.hits, page > 1);\n    updateLoadMoreVisibility(page, totalHits, data.hits.length);\n  } catch (error) {\n    iziToast.error({\n      message: 'Something went wrong. Please try again later.',\n      position: 'topRight',\n    });\n  } finally {\n    hideLoading();\n  }\n}\n\nasync function fetchImages(query, page = 1) {\n  const params = {\n    key: API_KEY,\n    q: query,\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: 'true',\n    page: page,\n    per_page: 20,\n  };\n\n  const response = await axios.get(BASE_URL, { params });\n  if (response.status !== 200) {\n    throw new Error('Fetch failed');\n  }\n  return response.data;\n}\n\nfunction renderGallery(images, append = false) {\n  const markup = images\n    .map(image => `\n      <li class=\"gallery-item\">\n        <div class=\"photo-card\">\n          <a class=\"gallery-link\" href=\"${image.largeImageURL}\">\n            <img class=\"gallery-image\" src=\"${image.webformatURL}\" alt=\"${image.tags}\" loading=\"lazy\" />\n          </a>\n          <div class=\"info\">\n            <div class=\"info-column\">\n              <span class=\"info-label\">Likes</span>\n              <span class=\"info-value\">${image.likes}</span>\n            </div>\n            <div class=\"info-column\">\n              <span class=\"info-label\">Views</span>\n              <span class=\"info-value\">${image.views}</span>\n            </div>\n            <div class=\"info-column\">\n              <span class=\"info-label\">Comments</span>\n              <span class=\"info-value\">${image.comments}</span>\n            </div>\n            <div class=\"info-column\">\n              <span class=\"info-label\">Downloads</span>\n              <span class=\"info-value\">${image.downloads}</span>\n            </div>\n          </div>\n        </div>\n      </li>\n    `)\n    .join('');\n\n  if (append) {\n    gallery.insertAdjacentHTML('beforeend', markup);\n  } else {\n    gallery.innerHTML = markup;\n  }\n\n  lightbox.refresh();\n\n  // Scroll down after loading more (append is true)\n  if (append) {\n    scrollPage();\n  }\n}\n\nfunction updateLoadMoreVisibility(page, totalHits, hitsCount) {\n  const totalPages = Math.ceil(totalHits / 40);\n  if (page < totalPages) {\n    showLoadMoreBtn();\n    hideEndMessage();\n  } else {\n    hideLoadMoreBtn();\n    showEndMessage();\n\n    // Tüm sonuçlar yüklendiyse kullanıcıyı bilgilendir:\n    iziToast.info({\n      class: 'my-end-toast',\n      message: \"We're sorry, but you've reached the end of search results.\",\n      position: 'topRight',\n    });\n  }\n}\n\n\nfunction scrollPage() {\n  const firstGalleryItem = gallery.querySelector('.gallery-item');\n  if (!firstGalleryItem) return;\n  const { height: cardHeight } = firstGalleryItem.getBoundingClientRect();\n  window.scrollBy({\n    top: cardHeight * 2,\n    behavior: 'smooth',\n  });\n}\n\nfunction showLoading() {\n  loader.hidden = false;\n  loadingText.hidden = false;\n}\n\nfunction hideLoading() {\n  loader.hidden = true;\n  loadingText.hidden = true;\n}\n\nfunction showLoadMoreBtn() {\n loadMoreBtn.style.display = 'block';\n}\n\nfunction hideLoadMoreBtn() {\n  loadMoreBtn.style.display = 'none';\n}\n\nfunction showEndMessage() {\n  endMessage.hidden = false;\n}\n\nfunction hideEndMessage() {\n  endMessage.hidden = true;\n}\n\n"],"names":["form","gallery","loadMoreBtn","loader","loadingText","endMessage","BASE_URL","API_KEY","lightbox","SimpleLightbox","currentPage","currentQuery","totalHits","hideLoadMoreBtn","query","startNewSearch","event","updateQueryParam","performSearch","newUrl","hideEndMessage","page","showLoading","data","fetchImages","iziToast","hideLoading","renderGallery","updateLoadMoreVisibility","params","response","axios","images","append","markup","image","scrollPage","hitsCount","totalPages","showLoadMoreBtn","showEndMessage","firstGalleryItem","cardHeight"],"mappings":"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"}